<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Boxing</title>
  <style>
    body {
      margin: 0;
      display: flex;
      min-height: 100vh;
      overflow: hidden;
      background: radial-gradient(circle at top, #222, #000);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
    }
    #sidebar {
      width: 220px;
      background: rgba(0,0,0,0.7);
      padding: 20px;
      box-shadow: 2px 0 8px rgba(0,0,0,0.2);
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #sidebar li { margin: 15px 0; }
    #sidebar a {
      color: #fff;
      text-decoration: none;
      transition: color 0.3s;
    }
    #sidebar a:hover { color: #ffea00; }
    #game-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      overflow: hidden;
      padding: 20px;
    }
    canvas {
      background: #000;
      border: 2px solid #fff;
      border-radius: 8px;
    }
    #info { margin-top: 10px; text-align: center; }
  </style>
</head>
<body>
  <div id="sidebar-placeholder"></div>
  <div id="game-container">
    <h1>Boxing</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="info">Use F/J to punch, Space to block, A/D to dodge, R to restart</div>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const crowd = Array.from({length:80},()=>({
      x:Math.random()*canvas.width,
      y:Math.random()*200,
      r:Math.random()*15+5,
      a:Math.random()*0.5+0.2
    }));

    const ring = {
      fl:{x:canvas.width*0.2,y:canvas.height-80},
      fr:{x:canvas.width*0.8,y:canvas.height-80},
      bl:{x:canvas.width*0.3,y:canvas.height-260},
      br:{x:canvas.width*0.7,y:canvas.height-260}
    };

    const opponents = [
      {name:'Rookie',color:'#0f0',maxHealth:80,cooldown:750,punchSpeed:175,twitch:250,block:0.1,dodge:0.05,power:8},
      {name:'Striker',color:'#fa0',maxHealth:100,cooldown:650,punchSpeed:150,twitch:200,block:0.2,dodge:0.35,power:12},
      {name:'Champion',color:'#f00',maxHealth:130,cooldown:600,punchSpeed:140,twitch:150,block:0.3,dodge:0.2,power:20},
      {name:'The Viper',color:'#f0f',maxHealth:160,cooldown:550,punchSpeed:120,twitch:130,block:0.4,dodge:0.5,power:22},
      {name:'Iron Titan',color:'#ff0',maxHealth:220,cooldown:500,punchSpeed:110,twitch:120,block:0.5,dodge:0.3,power:28}
    ];

    let opponentIndex=0;
    let opponent;
    let oppState='idle';
    let oppTimer=0;
    let oppArm='left';
    let oppPunch=0;
    let oppHit=false;
    let oppX=0;
    let oppXTarget=0;
    let oppDodgeTime=0;

    let playerHealth=100;
    let playerStamina=100;
    let combo=0;
    let comboTimer=0;
    let playerX=0;
    let leftPunch=0;
    let rightPunch=0;
    let blocking=0;
    let playerHitLeft=false;
    let playerHitRight=false;
    let moveLeft=false,moveRight=false;
    let message='';
    let gameOver=false;
    let roundTime=60000;

    function newOpponent(){
      const base=opponents[opponentIndex];
      opponent={...base,health:base.maxHealth};
      oppState='idle';
      oppTimer=base.cooldown;
      oppHit=false;
      oppX=0;
      playerHitLeft=false;
      playerHitRight=false;
      message='Opponent '+(opponentIndex+1)+'/'+opponents.length+': '+opponent.name;
    }
    newOpponent();

    document.addEventListener('keydown',e=>{
      if(gameOver && e.code==='KeyR') restart();
      if(gameOver) return;
      if(e.code==='KeyF' && leftPunch<=0 && playerStamina>=20){ leftPunch=1; playerStamina-=20; }
      if(e.code==='KeyJ' && rightPunch<=0 && playerStamina>=20){ rightPunch=1; playerStamina-=20; }
      if(e.code==='Space' && blocking<=0 && playerStamina>=10){ blocking=400; playerStamina-=10; }
      if(e.code==='ArrowLeft'||e.code==='KeyA') moveLeft=true;
      if(e.code==='ArrowRight'||e.code==='KeyD') moveRight=true;
    });
    document.addEventListener('keyup',e=>{
      if(e.code==='ArrowLeft'||e.code==='KeyA') moveLeft=false;
      if(e.code==='ArrowRight'||e.code==='KeyD') moveRight=false;
    });

    function restart(){
      playerHealth=100;
      playerStamina=100;
      combo=0;
      comboTimer=0;
      playerX=0;
      leftPunch=0;
      rightPunch=0;
      blocking=0;
      opponentIndex=0;
      roundTime=60000;
      gameOver=false;
      newOpponent();
    }

    let last=performance.now();
    function gameLoop(now){
      const dt=now-last; last=now;
      ctx.clearRect(0,0,canvas.width,canvas.height);

      if(!gameOver){
        roundTime-=dt;
        updateOpponent(dt);
        updatePlayer(dt);
        checkOpponentHits();

        if(roundTime<=0){
          gameOver=true;
          message=playerHealth>opponent.health?'Time! You win!':'Time! You lose!';
        }
        if(playerHealth<=0){ playerHealth=0; gameOver=true; message='You lose!'; }
        if(opponent.health<=0){
          opponentIndex++;
          if(opponentIndex<opponents.length){
            newOpponent();
          }else{
            gameOver=true; message='You win!';
          }
        }
      }

      drawBackground();
      drawRing();
      drawOpponent();
      drawPlayer();
      drawHUD();

      requestAnimationFrame(gameLoop);
    }
    requestAnimationFrame(gameLoop);

    function updatePlayer(dt){
      if(leftPunch>0){ leftPunch-=dt/200; if(leftPunch<0) leftPunch=0; }
      if(rightPunch>0){ rightPunch-=dt/200; if(rightPunch<0) rightPunch=0; }
      if(blocking>0) blocking-=dt; else blocking=0;
      playerStamina+=dt/100; if(playerStamina>100) playerStamina=100;
      if(comboTimer>0){ comboTimer-=dt; if(comboTimer<=0) combo=0; }

      const speed=dt/400;
      if(moveLeft) playerX-=speed;
      if(moveRight) playerX+=speed;
      if(!moveLeft&&!moveRight){
        if(playerX>0) playerX=Math.max(0,playerX-speed);
        if(playerX<0) playerX=Math.min(0,playerX+speed);
      }
      if(playerX<-1) playerX=-1;
      if(playerX>1) playerX=1;
    }

    function updateOpponent(dt){
      switch(oppState){
        case 'idle':
          oppTimer-=dt;
          if(oppTimer<=0){
            if((leftPunch>0.3||rightPunch>0.3) && Math.random()<opponent.block){
              oppState='block';
              oppTimer=400;
            }else if((leftPunch>0.3||rightPunch>0.3) && Math.random()<opponent.dodge){
              oppState='dodge';
              oppTimer=300;
              oppXTarget=Math.random()<0.5?-80:80;
              oppDodgeTime=0;
            }else{
              oppArm=Math.random()<0.5?'left':'right';
              oppState='twitch';
              oppTimer=opponent.twitch;
              oppHit=false;
            }
          }
          break;
        case 'twitch':
          oppTimer-=dt;
          if(oppTimer<=0){
            oppState='punch';
            oppPunch=0;
          }
          break;
        case 'punch':
          oppPunch+=dt/opponent.punchSpeed;
          if(oppPunch>=0.75 && !oppHit){
            checkPlayerHit();
            oppHit=true;
          }
          if(oppPunch>=1){
            oppState='recover';
            oppTimer=400;
          }
          break;
        case 'recover':
          oppTimer-=dt;
          if(oppTimer<=0){
            oppState='idle';
            oppTimer=opponent.cooldown;
          }
          break;
        case 'block':
          oppTimer-=dt;
          if(oppTimer<=0){
            oppState='idle';
            oppTimer=opponent.cooldown;
          }
          break;
        case 'dodge':
          oppDodgeTime+=dt;
          const progress=oppDodgeTime/oppTimer;
          oppX=Math.sin(Math.min(progress,1)*Math.PI)*oppXTarget;
          if(oppDodgeTime>=oppTimer){
            oppX=0;
            oppState='idle';
            oppTimer=opponent.cooldown;
          }
          break;
      }
    }

    function checkPlayerHit(){
      const headX=canvas.width/2 + playerX*80;
      const headY=canvas.height-100;
      const x=canvas.width/2 + oppX + (oppArm==='left'?-40:40);
      const y=canvas.height/2 + 40 + 200*oppPunch;
      const dodged=oppState==='dodge';
      if(distance(headX,headY,x,y)<30 && blocking<=0 && !dodged){
        const damage = opponent.power * oppPunch;
        playerHealth-=damage;
        playerStamina-=damage*1.2;
        if(playerStamina<0) playerStamina=0;
        message='Ouch!';
      }else if(dodged){
        message='Dodged!';
      }else if(blocking>0){
        message='Blocked!';
      }
    }

    function checkOpponentHits(){
      const hx=canvas.width/2 + oppX;
      const hy=canvas.height/2 - 50;
      const baseDamage=10;

      if(leftPunch>0.5 && !playerHitLeft){
        const p=punchPos('left');
        if(distance(p.x,p.y,hx,hy)<40){
          if(oppState==='block'){
            message='Opponent blocked!';
          }else{
            const dmg=baseDamage + combo*5;
            opponent.health-=dmg;
            combo++; comboTimer=1500;
            message='Hit! Combo x'+combo;
          }
          playerHitLeft=true;
        }
      }
      if(leftPunch<=0.1) playerHitLeft=false;

      if(rightPunch>0.5 && !playerHitRight){
        const p=punchPos('right');
        if(distance(p.x,p.y,hx,hy)<40){
          if(oppState==='block'){
            message='Opponent blocked!';
          }else{
            const dmg=baseDamage + combo*5;
            opponent.health-=dmg;
            combo++; comboTimer=1500;
            message='Hit! Combo x'+combo;
          }
          playerHitRight=true;
        }
      }
      if(rightPunch<=0.1) playerHitRight=false;
    }

    function punchPos(side){
      const base=canvas.width/2 + playerX*80;
      if(side==='left')
        return {x: base-40, y: canvas.height - leftPunch*300 - 60};
      else
        return {x: base+40, y: canvas.height - rightPunch*300 - 60};
    }

    function drawBackground(){
      const grad=ctx.createRadialGradient(canvas.width/2,0,50,canvas.width/2,canvas.height,canvas.height);
      grad.addColorStop(0,'#222');
      grad.addColorStop(1,'#000');
      ctx.fillStyle=grad;
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#111';
      crowd.forEach(c=>{
        ctx.globalAlpha=c.a;
        ctx.beginPath();
        ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
        ctx.fill();
      });
      ctx.globalAlpha=1;
    }

    function drawRing(){
      const {fl,fr,bl,br}=ring;
      const matGrad=ctx.createLinearGradient(bl.x,bl.y,bl.x,bl.y-180);
      matGrad.addColorStop(0,'#2b2b2b');
      matGrad.addColorStop(1,'#666');
      ctx.fillStyle=matGrad;
      ctx.beginPath();
      ctx.moveTo(fl.x,fl.y); ctx.lineTo(bl.x,bl.y);
      ctx.lineTo(br.x,br.y); ctx.lineTo(fr.x,fr.y);
      ctx.closePath(); ctx.fill();
      ctx.strokeStyle='#888';
      ctx.lineWidth=4;
      ctx.stroke();

      const ropeColors=['#f00','#fff','#00f'];
      for(let i=1;i<=3;i++){
        const h=i*10;
        ctx.strokeStyle=ropeColors[i-1];
        ctx.lineWidth=3;
        ctx.beginPath();
        ctx.moveTo(bl.x,bl.y - h); ctx.lineTo(br.x,br.y - h); ctx.lineTo(fr.x,fr.y - h);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(bl.x,bl.y - h); ctx.lineTo(fl.x,fl.y - h);
        ctx.stroke();
      }

      ctx.fillStyle='#555';
      [fl,fr,bl,br].forEach(c=>{
        ctx.fillRect(c.x-5,c.y-40,10,40);
      });
    }

    function drawPlayer(){
      const base=canvas.width/2 + playerX*80;
      ctx.lineWidth=6;

      let p=punchPos('left');
      ctx.strokeStyle='#00bfff';
      ctx.beginPath(); ctx.moveTo(base-60,canvas.height); ctx.lineTo(p.x,p.y); ctx.stroke();
      ctx.fillStyle='#ff4444';
      ctx.beginPath(); ctx.arc(p.x,p.y,18,0,Math.PI*2); ctx.fill();

      p=punchPos('right');
      ctx.beginPath(); ctx.moveTo(base+60,canvas.height); ctx.lineTo(p.x,p.y); ctx.stroke();
      ctx.beginPath(); ctx.arc(p.x,p.y,18,0,Math.PI*2); ctx.fill();

      const bodyGrad=ctx.createLinearGradient(base,canvas.height-160,base,canvas.height);
      bodyGrad.addColorStop(0,'#00bfff');
      bodyGrad.addColorStop(1,'#005f9e');
      ctx.fillStyle=bodyGrad;
      ctx.beginPath();
      ctx.arc(base,canvas.height-100,25,0,Math.PI*2);
      ctx.fill();
      ctx.strokeStyle='#00bfff';
      ctx.beginPath();
      ctx.moveTo(base,canvas.height-100);
      ctx.lineTo(base,canvas.height-20);
      ctx.stroke();

      if(blocking>0){
        ctx.strokeStyle='#ff0';
        ctx.lineWidth=3;
        ctx.strokeRect(base-40,canvas.height-120,80,80);
      }
    }

    function drawOpponent(){
      if(opponent.health<=0) return;
      const x=canvas.width/2 + oppX, y=canvas.height/2;
      ctx.lineWidth=6;

      const bodyGrad=ctx.createLinearGradient(x,y-80,x,y+60);
      bodyGrad.addColorStop(0,opponent.color);
      bodyGrad.addColorStop(1,'#222');
      ctx.fillStyle=bodyGrad;
      ctx.strokeStyle=opponent.color;
      ctx.beginPath();
      ctx.arc(x,y-50,30,0,Math.PI*2);
      ctx.fill();
      ctx.beginPath();
      ctx.rect(x-20,y-20,40,80);
      ctx.stroke();

      ctx.fillStyle=opponent.color;
      if(oppState==='block'){
        ctx.fillRect(x-40,y+35,80,10);
      }else{
        const lp=oppState==='punch'&&oppArm==='left'?oppPunch*200:oppState==='twitch'&&oppArm==='left'?10:0;
        ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x-40,y+40+lp); ctx.stroke();
        ctx.beginPath(); ctx.arc(x-40,y+40+lp,12,0,Math.PI*2); ctx.fill();
        const rp=oppState==='punch'&&oppArm==='right'?oppPunch*200:oppState==='twitch'&&oppArm==='right'?10:0;
        ctx.beginPath(); ctx.moveTo(x,y); ctx.lineTo(x+40,y+40+rp); ctx.stroke();
        ctx.beginPath(); ctx.arc(x+40,y+40+rp,12,0,Math.PI*2); ctx.fill();
      }

      ctx.beginPath();
      ctx.moveTo(x,y+60); ctx.lineTo(x-30,y+120);
      ctx.moveTo(x,y+60); ctx.lineTo(x+30,y+120);
      ctx.stroke();
    }

    function drawHUD(){
      ctx.fillStyle='#f00';
      ctx.fillRect(20,20,200*(opponent.health/opponent.maxHealth),20);
      ctx.strokeStyle='#fff';
      ctx.strokeRect(20,20,200,20);
      ctx.fillStyle='#00f';
      ctx.fillRect(canvas.width-220,20,200*(playerHealth/100),20);
      ctx.strokeRect(canvas.width-220,20,200,20);
      ctx.fillStyle='#0f0';
      ctx.fillRect(canvas.width-220,45,200*(playerStamina/100),10);
      ctx.strokeRect(canvas.width-220,45,200,10);
      ctx.fillStyle='#fff';
      ctx.font='20px sans-serif';
      ctx.fillText('Time:'+Math.ceil(roundTime/1000),canvas.width/2-40,40);
      if(message) ctx.fillText(message,canvas.width/2-ctx.measureText(message).width/2,canvas.height-20);
      if(gameOver) ctx.fillText('Press R to Restart',canvas.width/2-90,canvas.height-50);
    }

    function distance(x1,y1,x2,y2){
      const dx=x1-x2, dy=y1-y2;
      return Math.sqrt(dx*dx+dy*dy);
    }
  </script>
  <script>
    fetch('sidebar.html')
      .then(r=>r.text())
      .then(html=>{
        const placeholder=document.getElementById('sidebar-placeholder');
        if(placeholder) placeholder.outerHTML=html;
      });
  </script>
</body>
</html>
