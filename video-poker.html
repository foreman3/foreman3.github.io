<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Poker Lounge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: dark;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      margin: 0;
      display: flex;
      min-height: 100vh;
      background: radial-gradient(circle at top, #1a093f, #060114 65%);
      color: #f2f6ff;
    }
    #sidebar-placeholder {
      min-width: 240px;
      background: rgba(8, 5, 20, 0.85);
      backdrop-filter: blur(6px);
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: clamp(1.5rem, 4vw, 3rem);
      gap: 1.5rem;
    }
    header {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.75rem;
    }
    header h1 {
      font-family: "Press Start 2P", cursive;
      letter-spacing: 4px;
      font-size: clamp(1.5rem, 4vw, 2.25rem);
      margin: 0;
      color: #78f3ff;
      text-shadow: 0 0 18px rgba(120, 243, 255, 0.45);
    }
    header p {
      margin: 0;
      max-width: 540px;
      color: rgba(230, 235, 255, 0.78);
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .status-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      background: rgba(15, 9, 45, 0.65);
      border: 1px solid rgba(120, 243, 255, 0.18);
      border-radius: 18px;
      padding: 1rem 1.25rem;
      box-shadow: 0 18px 35px rgba(6, 0, 25, 0.45);
    }
    .status-panel > div {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
    }
    .status-panel button {
      background: linear-gradient(135deg, #3f0da5, #8625ff);
      border: none;
      color: white;
      padding: 0.45rem 0.85rem;
      border-radius: 10px;
      font-weight: 600;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 8px 16px rgba(57, 18, 130, 0.45);
    }
    .status-panel button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    .status-panel button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 22px rgba(108, 30, 200, 0.55);
    }
    .cards-area {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: rgba(18, 10, 52, 0.7);
      border-radius: 24px;
      padding: 1.5rem;
      border: 1px solid rgba(120, 243, 255, 0.15);
      box-shadow: 0 30px 55px rgba(8, 1, 35, 0.45);
    }
    .card-row {
      display: grid;
      grid-template-columns: repeat(5, minmax(110px, 1fr));
      gap: clamp(0.75rem, 2vw, 1.5rem);
      justify-items: center;
    }
    .card-slot {
      position: relative;
      width: 100%;
      aspect-ratio: 0.72;
      border-radius: 16px;
      background: linear-gradient(160deg, rgba(255,255,255,0.12), rgba(120,243,255,0.08));
      border: 1px solid rgba(120, 243, 255, 0.22);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card-slot.placeholder {
      cursor: default;
      display: grid;
      place-items: center;
      color: rgba(255,255,255,0.4);
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: 2px;
    }
    .card-slot:hover {
      transform: translateY(-4px);
      box-shadow: 0 18px 30px rgba(6, 0, 35, 0.35);
    }
    .card-slot.disabled,
    .card-slot.placeholder {
      transform: none;
      box-shadow: none;
    }
    .card-face {
      position: absolute;
      inset: 0;
      padding: 0.85rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background:
        radial-gradient(circle at top, rgba(255, 255, 255, 0.96), rgba(249, 249, 249, 0.95)),
        radial-gradient(circle at bottom right, rgba(120, 243, 255, 0.12), transparent 65%),
        radial-gradient(circle at top left, rgba(255, 119, 192, 0.12), transparent 60%);
      color: #1a1232;
      overflow: hidden;
    }
    .card-face.red {
      color: #b00047;
    }
    .card-face::after {
      content: "";
      position: absolute;
      inset: 12%;
      border-radius: 18px;
      border: 1px dashed rgba(26, 18, 50, 0.08);
      pointer-events: none;
    }
    .card-rank {
      font-size: clamp(1.5rem, 3vw, 2.4rem);
      font-weight: 700;
    }
    .card-suit {
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      align-self: flex-end;
    }
    .card-art {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.2rem;
      filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.18));
      color: #2433d9;
    }
    .card-art svg {
      width: clamp(62px, 12vw, 96px);
      height: auto;
    }
    .card-art.face-card svg {
      width: clamp(92px, 16vw, 128px);
    }
    .card-art.ace svg {
      width: clamp(72px, 14vw, 110px);
    }
    .card-face.red .card-art {
      color: #c51f5d;
    }
    .card-pips {
      width: 90%;
      height: 90%;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(5, 1fr);
      gap: 0.2rem;
    }
    .card-pip {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-pip svg {
      width: clamp(26px, 5vw, 40px);
      height: auto;
      color: inherit;
    }
    .hold-tag {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 30%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(0.85rem, 2vw, 1.2rem);
      letter-spacing: 2px;
      text-transform: uppercase;
      background: rgba(120, 243, 255, 0.65);
      color: #0b0424;
      border-radius: 18px;
      font-weight: 700;
      opacity: 0;
      transition: opacity 0.2s ease;
      backdrop-filter: blur(2px);
    }
    .card-slot.held .hold-tag {
      opacity: 1;
    }
    .card-slot.disabled {
      pointer-events: none;
      opacity: 0.75;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }
    .actions button {
      background: linear-gradient(135deg, #ff7bc0, #ff476a);
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.3rem;
      color: white;
      font-size: 0.95rem;
      letter-spacing: 1px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 12px 24px rgba(255, 99, 170, 0.4);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .actions button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }
    .actions button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(255, 99, 170, 0.55);
    }
    .message {
      min-height: 2rem;
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    #payout-section {
      background: rgba(10, 5, 30, 0.65);
      border-radius: 22px;
      padding: 1.25rem;
      border: 1px solid rgba(120,243,255,0.14);
      box-shadow: 0 20px 45px rgba(5, 0, 25, 0.45);
      overflow-x: auto;
    }
    #payout-section h2 {
      margin-top: 0;
      font-size: 1.1rem;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #ff9df2;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 420px;
    }
    th, td {
      padding: 0.55rem 0.75rem;
      text-align: center;
      border-bottom: 1px solid rgba(120, 243, 255, 0.1);
    }
    th {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.85rem;
      color: rgba(200, 240, 255, 0.9);
      letter-spacing: 1.5px;
    }
    tbody tr.highlight {
      background: rgba(120, 243, 255, 0.16);
      box-shadow: inset 0 0 22px rgba(120,243,255,0.22);
    }
    tbody td.bet-highlight {
      background: rgba(255, 119, 192, 0.28);
      color: #fff;
      font-weight: 700;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(6, 2, 20, 0.8);
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      z-index: 30;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .overlay.active {
      visibility: visible;
      opacity: 1;
    }
    .overlay-content {
      background: rgba(15, 8, 45, 0.95);
      padding: clamp(1.5rem, 3vw, 2.5rem);
      border-radius: 24px;
      border: 1px solid rgba(120, 243, 255, 0.2);
      max-width: 880px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      box-shadow: 0 24px 65px rgba(2, 0, 25, 0.55);
    }
    .overlay-content h2 {
      margin: 0;
      font-size: clamp(1.4rem, 3vw, 1.8rem);
      color: #ff9df2;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .machine-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.25rem;
    }
    .machine-card {
      border: none;
      border-radius: 20px;
      padding: 1.25rem;
      text-align: left;
      background: linear-gradient(150deg, rgba(120, 243, 255, 0.15), rgba(255, 119, 192, 0.12));
      color: inherit;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      box-shadow: 0 18px 35px rgba(5, 0, 30, 0.35);
    }
    .machine-card:hover,
    .machine-card:focus-visible {
      transform: translateY(-4px);
      box-shadow: 0 24px 40px rgba(10, 0, 45, 0.45);
      background: linear-gradient(150deg, rgba(120, 243, 255, 0.25), rgba(255, 119, 192, 0.2));
    }
    .machine-card h3 {
      margin: 0;
      font-size: 1.1rem;
      color: #78f3ff;
      letter-spacing: 1.5px;
    }
    .machine-card p {
      margin: 0;
      font-size: 0.9rem;
      color: rgba(220, 235, 255, 0.8);
      line-height: 1.5;
    }
    .machine-card .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }
    .machine-card .tag {
      background: rgba(255, 119, 192, 0.22);
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.7rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 600;
    }
    @media (max-width: 920px) {
      body {
        flex-direction: column;
      }
      #sidebar-placeholder {
        width: 100%;
        min-height: 60px;
      }
      main {
        padding: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div id="sidebar-placeholder"></div>
  <main>
    <header>
      <h1>Video Poker Lounge</h1>
      <p>Pick a machine, place your bet, and draw to the best poker hand you can. Each machine uses a fresh, fair 52-card shuffle
        before every hand and pays exactly according to its posted table.</p>
    </header>

    <section class="status-panel">
      <div>Credits: <span id="credit-display">100</span></div>
      <div>
        Bet:
        <button type="button" id="bet-down">-</button>
        <span id="bet-display">1</span>
        <button type="button" id="bet-up">+</button>
      </div>
      <div class="actions">
        <button type="button" id="deal-button">Deal</button>
        <button type="button" id="change-machine">Change Machine</button>
        <button type="button" id="add-credits">Add 50 Credits</button>
      </div>
    </section>

    <section class="cards-area">
      <div class="card-row" id="card-row"></div>
      <div class="message" id="status-message">Select a machine to begin.</div>
    </section>

    <section id="payout-section">
      <h2 id="payout-title">Payouts</h2>
      <table>
        <thead>
          <tr>
            <th>Hand</th>
            <th>Bet 1</th>
            <th>Bet 2</th>
            <th>Bet 3</th>
            <th>Bet 4</th>
            <th>Bet 5</th>
          </tr>
        </thead>
        <tbody id="payout-body"></tbody>
      </table>
    </section>
  </main>

  <div class="overlay active" id="machine-overlay" role="dialog" aria-modal="true">
    <div class="overlay-content">
      <h2>Choose Your Video Poker Machine</h2>
      <p>Select a game to view its pay table and start playing. You can change machines at any time between hands.</p>
      <div class="machine-grid" id="machine-grid"></div>
    </div>
  </div>

  <script>
    const machines = [
      {
        id: 'jacks',
        name: 'Jacks or Better',
        description: 'Classic draw poker. Pair of jacks or higher to win and a 4,000 coin royal for five credits.',
        tags: ['Standard Deck', '9/6 Payouts'],
        payouts: [
          { hand: 'Royal Flush', values: [250, 500, 750, 1000, 4000] },
          { hand: 'Straight Flush', values: [50, 100, 150, 200, 250] },
          { hand: 'Four of a Kind', values: [25, 50, 75, 100, 125] },
          { hand: 'Full House', values: [9, 18, 27, 36, 45] },
          { hand: 'Flush', values: [6, 12, 18, 24, 30] },
          { hand: 'Straight', values: [4, 8, 12, 16, 20] },
          { hand: 'Three of a Kind', values: [3, 6, 9, 12, 15] },
          { hand: 'Two Pair', values: [2, 4, 6, 8, 10] },
          { hand: 'Jacks or Better', values: [1, 2, 3, 4, 5] }
        ]
      },
      {
        id: 'bonus',
        name: 'Bonus Poker',
        description: 'Bonus payouts for four of a kind hands. Two pair pays even money like a true casino Bonus Poker game.',
        tags: ['Bonus Quads', 'Classic Rules'],
        payouts: [
          { hand: 'Royal Flush', values: [250, 500, 750, 1000, 4000] },
          { hand: 'Straight Flush', values: [50, 100, 150, 200, 250] },
          { hand: 'Four Aces', values: [80, 160, 240, 320, 400] },
          { hand: 'Four 2s-4s', values: [40, 80, 120, 160, 200] },
          { hand: 'Four 5s-Ks', values: [25, 50, 75, 100, 125] },
          { hand: 'Full House', values: [8, 16, 24, 32, 40] },
          { hand: 'Flush', values: [5, 10, 15, 20, 25] },
          { hand: 'Straight', values: [4, 8, 12, 16, 20] },
          { hand: 'Three of a Kind', values: [3, 6, 9, 12, 15] },
          { hand: 'Two Pair', values: [1, 2, 3, 4, 5] },
          { hand: 'Jacks or Better', values: [1, 2, 3, 4, 5] }
        ]
      },
      {
        id: 'deuces',
        name: 'Deuces Wild',
        description: 'All twos are wild. Make the best hand you can with flexible straights, flushes, and five of a kind.',
        tags: ['Wild Cards', 'Bonus Hands'],
        payouts: [
          { hand: 'Natural Royal Flush', values: [250, 500, 750, 1000, 4000] },
          { hand: 'Four Deuces', values: [200, 400, 600, 800, 1000] },
          { hand: 'Wild Royal Flush', values: [25, 50, 75, 100, 125] },
          { hand: 'Five of a Kind', values: [16, 32, 48, 64, 80] },
          { hand: 'Straight Flush', values: [13, 26, 39, 52, 65] },
          { hand: 'Four of a Kind', values: [4, 8, 12, 16, 20] },
          { hand: 'Full House', values: [3, 6, 9, 12, 15] },
          { hand: 'Flush', values: [2, 4, 6, 8, 10] },
          { hand: 'Straight', values: [2, 4, 6, 8, 10] },
          { hand: 'Three of a Kind', values: [1, 2, 3, 4, 5] }
        ]
      }
    ];

    const suitSymbols = {
      hearts: '♥',
      diamonds: '♦',
      clubs: '♣',
      spades: '♠'
    };

    const suitSvgTemplates = {
      pip: {
        hearts: `
          <svg viewBox="0 0 40 40" role="img" aria-hidden="true">
            <path d="M20 35 C20 35 4 25 4 14 C4 8 8 4 14 4 C18 4 20 6 20 9 C20 6 22 4 26 4 C32 4 36 8 36 14 C36 25 20 35 20 35 Z" fill="currentColor" />
            <path d="M20 14 C17 10 12 8 8 11" stroke="rgba(255,255,255,0.6)" stroke-width="3" stroke-linecap="round" fill="none" />
          </svg>
        `,
        diamonds: `
          <svg viewBox="0 0 40 40" role="img" aria-hidden="true">
            <polygon points="20,3 36,20 20,37 4,20" fill="currentColor" />
            <polygon points="20,9 30,20 20,31 10,20" fill="rgba(255,255,255,0.45)" />
          </svg>
        `,
        clubs: `
          <svg viewBox="0 0 40 40" role="img" aria-hidden="true">
            <circle cx="20" cy="11" r="9" fill="currentColor" />
            <circle cx="11" cy="23" r="9" fill="currentColor" />
            <circle cx="29" cy="23" r="9" fill="currentColor" />
            <path d="M20 20 C16 27 15 31 15 35 L25 35 C25 31 24 27 20 20 Z" fill="currentColor" />
            <path d="M22 9 C20 6 15 6 12 9" stroke="rgba(255,255,255,0.55)" stroke-width="2.6" stroke-linecap="round" fill="none" />
          </svg>
        `,
        spades: `
          <svg viewBox="0 0 40 40" role="img" aria-hidden="true">
            <path d="M20 3 C14 12 4 18 4 28 C4 33 8 37 13 37 C16 37 18.6 35.5 20 33.6 C21.4 35.5 24 37 27 37 C32 37 36 33 36 28 C36 18 26 12 20 3 Z" fill="currentColor" />
            <path d="M20 22 C17 27.5 17 32 17 37 L23 37 C23 32 23 27.5 20 22 Z" fill="rgba(255,255,255,0.45)" />
            <path d="M20 12 C14 12 9 18 7.5 23" stroke="rgba(255,255,255,0.55)" stroke-width="2.6" stroke-linecap="round" fill="none" />
          </svg>
        `
      },
      emblem: {
        hearts: `
          <svg viewBox="0 0 140 140" role="img" aria-hidden="true">
            <rect x="12" y="12" width="116" height="116" rx="28" fill="rgba(255, 239, 246, 0.92)" stroke="rgba(197, 31, 93, 0.38)" stroke-width="6" />
            <path d="M70 112 C70 112 26 84 26 54 C26 36 38 24 52 24 C62 24 68 30 70 38 C72 30 78 24 88 24 C102 24 114 36 114 54 C114 84 70 112 70 112 Z" fill="currentColor" />
            <path d="M70 50 C60 38 48 32 36 36" stroke="rgba(255,255,255,0.6)" stroke-width="6" stroke-linecap="round" fill="none" />
            <circle cx="70" cy="60" r="14" fill="rgba(255,255,255,0.25)" />
          </svg>
        `,
        diamonds: `
          <svg viewBox="0 0 140 140" role="img" aria-hidden="true">
            <rect x="12" y="12" width="116" height="116" rx="28" fill="rgba(240, 250, 255, 0.9)" stroke="rgba(205, 45, 90, 0.38)" stroke-width="6" />
            <polygon points="70,18 118,70 70,122 22,70" fill="currentColor" />
            <polygon points="70,36 100,70 70,104 40,70" fill="rgba(255,255,255,0.45)" />
            <polygon points="70,52 86,70 70,88 54,70" fill="rgba(255,255,255,0.25)" />
          </svg>
        `,
        clubs: `
          <svg viewBox="0 0 140 140" role="img" aria-hidden="true">
            <rect x="12" y="12" width="116" height="116" rx="28" fill="rgba(237, 245, 255, 0.92)" stroke="rgba(34, 54, 140, 0.42)" stroke-width="6" />
            <circle cx="70" cy="36" r="24" fill="currentColor" />
            <circle cx="42" cy="74" r="24" fill="currentColor" />
            <circle cx="98" cy="74" r="24" fill="currentColor" />
            <path d="M70 58 C56 84 52 100 52 118 L88 118 C88 100 84 84 70 58 Z" fill="currentColor" />
            <path d="M80 34 C76 28 60 26 50 34" stroke="rgba(255,255,255,0.6)" stroke-width="6" stroke-linecap="round" fill="none" />
          </svg>
        `,
        spades: `
          <svg viewBox="0 0 140 140" role="img" aria-hidden="true">
            <rect x="12" y="12" width="116" height="116" rx="28" fill="rgba(232, 240, 255, 0.92)" stroke="rgba(33, 48, 138, 0.42)" stroke-width="6" />
            <path d="M70 18 C70 18 22 70 22 102 C22 118 34 130 50 130 C58 130 64 126 68 120 C69 124 72 128 76 130 C92 130 104 118 104 102 C104 70 70 18 70 18 Z" fill="currentColor" />
            <path d="M70 78 C60 94 60 110 60 130 L80 130 C80 110 80 94 70 78 Z" fill="rgba(255,255,255,0.35)" />
            <path d="M70 40 C54 40 36 58 32 78" stroke="rgba(255,255,255,0.55)" stroke-width="6" stroke-linecap="round" fill="none" />
          </svg>
        `
      }
    };

    const pipLayouts = {
      2: [[0, 1], [4, 1]],
      3: [[0, 1], [2, 1], [4, 1]],
      4: [[0, 0], [0, 2], [4, 0], [4, 2]],
      5: [[0, 0], [0, 2], [2, 1], [4, 0], [4, 2]],
      6: [[0, 0], [0, 2], [2, 0], [2, 2], [4, 0], [4, 2]],
      7: [[0, 0], [0, 2], [2, 0], [2, 2], [4, 0], [4, 2], [1, 1]],
      8: [[0, 0], [0, 2], [2, 0], [2, 2], [4, 0], [4, 2], [1, 1], [3, 1]],
      9: [[0, 0], [0, 2], [2, 0], [2, 2], [4, 0], [4, 2], [1, 1], [3, 1], [2, 1]],
      10: [[0, 0], [0, 2], [1, 0], [1, 2], [2, 0], [2, 2], [3, 0], [3, 2], [4, 0], [4, 2]]
    };

    const faceArtTemplates = {
      11: {
        hearts: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="26" fill="#ffe5ef" stroke="#d66aa7" stroke-width="6" />
            <path d="M80 34 C66 34 54 46 54 60 L54 72 L44 88 L80 104 L116 88 L106 72 L106 60 C106 46 94 34 80 34 Z" fill="#f2b3cc" />
            <circle cx="80" cy="78" r="22" fill="#f9d9ba" />
            <path d="M66 70 C70 62 90 62 94 70" stroke="#532323" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 86 C74 90 86 90 90 86" stroke="#532323" stroke-width="4" stroke-linecap="round" fill="none" />
            <path d="M60 118 L80 108 L100 118 L92 134 L68 134 Z" fill="#c23a63" />
            <path d="M80 40 L88 54 L72 54 Z" fill="#8b2a4a" />
            <path d="M80 120 C72 120 64 128 64 136 C72 136 88 136 96 136 C96 128 88 120 80 120 Z" fill="#f9d9ba" opacity="0.4" />
          </svg>
        `,
        diamonds: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="26" fill="#f0f7ff" stroke="#2d88c4" stroke-width="6" />
            <path d="M80 36 C66 36 54 48 54 62 L54 78 L44 94 L80 110 L116 94 L106 78 L106 62 C106 48 94 36 80 36 Z" fill="#8bd2ff" />
            <circle cx="80" cy="80" r="22" fill="#f2d7b0" />
            <path d="M68 72 C74 68 86 68 92 72" stroke="#4a2b16" stroke-width="5" stroke-linecap="round" fill="none" />
            <path d="M72 90 C76 92 84 92 88 90" stroke="#4a2b16" stroke-width="4" stroke-linecap="round" fill="none" />
            <rect x="60" y="118" width="40" height="20" rx="10" fill="#2068b1" />
            <path d="M80 40 L90 58 L70 58 Z" fill="#154a7a" />
            <polygon points="80,122 90,138 70,138" fill="#8bd2ff" />
          </svg>
        `,
        clubs: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="26" fill="#eaf4ff" stroke="#24467d" stroke-width="6" />
            <path d="M80 38 C64 38 52 52 52 70 L52 82 L40 98 L80 118 L120 98 L108 82 L108 70 C108 52 96 38 80 38 Z" fill="#6b8dd8" />
            <circle cx="80" cy="82" r="22" fill="#f0cfa1" />
            <path d="M68 74 C72 70 88 70 92 74" stroke="#3b2713" stroke-width="5" stroke-linecap="round" fill="none" />
            <path d="M74 92 C78 94 82 94 86 92" stroke="#3b2713" stroke-width="4" stroke-linecap="round" fill="none" />
            <path d="M80 42 L92 58 L68 58 Z" fill="#1c2f57" />
            <path d="M58 118 C64 106 96 106 102 118 L96 138 L64 138 Z" fill="#12213f" />
            <circle cx="80" cy="124" r="10" fill="#6b8dd8" />
          </svg>
        `,
        spades: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="26" fill="#e9edff" stroke="#29316f" stroke-width="6" />
            <path d="M80 36 C62 36 50 50 50 70 L50 82 L40 100 L80 118 L120 100 L110 82 L110 70 C110 50 98 36 80 36 Z" fill="#5460b9" />
            <circle cx="80" cy="82" r="22" fill="#edd0a2" />
            <path d="M66 76 C72 68 88 68 94 76" stroke="#352516" stroke-width="5" stroke-linecap="round" fill="none" />
            <path d="M72 94 C78 98 82 98 88 94" stroke="#352516" stroke-width="4" stroke-linecap="round" fill="none" />
            <path d="M80 40 L94 60 L66 60 Z" fill="#1d2455" />
            <path d="M62 118 L80 108 L98 118 L92 138 L68 138 Z" fill="#1d2455" />
            <circle cx="80" cy="122" r="9" fill="#5460b9" />
          </svg>
        `
      },
      12: {
        hearts: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="30" fill="#ffe4f5" stroke="#d95b9f" stroke-width="6" />
            <path d="M80 30 C60 30 46 48 46 68 L46 84 L32 104 L80 126 L128 104 L114 84 L114 68 C114 48 100 30 80 30 Z" fill="#f7a2c5" />
            <circle cx="80" cy="78" r="26" fill="#fcdcc2" />
            <path d="M64 76 C70 70 90 70 96 76" stroke="#5a2c1c" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 96 C76 102 84 102 90 96" stroke="#5a2c1c" stroke-width="4" stroke-linecap="round" fill="none" />
            <path d="M80 40 L104 70 L56 70 Z" fill="#c94986" />
            <path d="M58 120 L80 110 L102 120 L94 140 L66 140 Z" fill="#a83470" />
            <path d="M80 56 C70 56 62 64 62 72 C68 74 92 74 98 72 C98 64 90 56 80 56 Z" fill="#fcdcc2" opacity="0.55" />
          </svg>
        `,
        diamonds: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="30" fill="#f4faff" stroke="#3a94d6" stroke-width="6" />
            <path d="M80 32 C60 32 48 50 48 72 L48 86 L34 108 L80 128 L126 108 L112 86 L112 72 C112 50 100 32 80 32 Z" fill="#79c1f0" />
            <circle cx="80" cy="82" r="26" fill="#f8ddc0" />
            <path d="M66 78 C72 74 88 74 94 78" stroke="#4d2d12" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M72 98 C78 102 82 102 88 98" stroke="#4d2d12" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,40 106,74 54,74" fill="#2371b3" />
            <path d="M58 120 L80 110 L102 120 L94 140 L66 140 Z" fill="#1a4f83" />
            <polygon points="80,118 94,140 66,140" fill="#79c1f0" opacity="0.6" />
          </svg>
        `,
        clubs: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="30" fill="#ecf6ff" stroke="#1f4c6f" stroke-width="6" />
            <path d="M80 32 C58 32 46 52 46 76 L46 90 L32 110 L80 132 L128 110 L114 90 L114 76 C114 52 102 32 80 32 Z" fill="#5aa9d8" />
            <circle cx="80" cy="82" r="26" fill="#f5d8b6" />
            <path d="M64 78 C70 72 90 72 96 78" stroke="#442912" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M72 100 C78 104 84 104 90 100" stroke="#442912" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,40 108,78 52,78" fill="#1c395a" />
            <path d="M60 122 L80 112 L100 122 L92 142 L68 142 Z" fill="#13253d" />
            <circle cx="80" cy="124" r="11" fill="#5aa9d8" />
          </svg>
        `,
        spades: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="30" fill="#e8efff" stroke="#1d3166" stroke-width="6" />
            <path d="M80 30 C58 30 44 50 44 76 L44 92 L30 112 L80 134 L130 112 L116 92 L116 76 C116 50 102 30 80 30 Z" fill="#4f67c0" />
            <circle cx="80" cy="82" r="26" fill="#f1d6b3" />
            <path d="M62 80 C70 72 90 72 98 80" stroke="#3a2614" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 102 C78 106 82 106 90 102" stroke="#3a2614" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,38 110,80 50,80" fill="#1b2759" />
            <path d="M60 122 L80 112 L100 122 L92 142 L68 142 Z" fill="#101b45" />
            <path d="M80 60 C70 60 62 68 62 78 C70 80 90 80 98 78 C98 68 90 60 80 60 Z" fill="#f1d6b3" opacity="0.55" />
          </svg>
        `
      },
      13: {
        hearts: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="32" fill="#ffe7f2" stroke="#d34986" stroke-width="6" />
            <path d="M80 28 C56 28 40 52 40 80 L40 96 L26 118 L80 138 L134 118 L120 96 L120 80 C120 52 104 28 80 28 Z" fill="#f58ab9" />
            <circle cx="80" cy="80" r="28" fill="#f5d4ad" />
            <path d="M62 82 C70 72 90 72 98 82" stroke="#4e291c" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 106 C78 110 82 110 90 106" stroke="#4e291c" stroke-width="4" stroke-linecap="round" fill="none" />
            <path d="M80 34 L112 78 L48 78 Z" fill="#c9346f" />
            <path d="M56 124 L80 112 L104 124 L96 144 L64 144 Z" fill="#9f2555" />
            <path d="M80 60 C68 60 58 70 58 82 C68 84 92 84 102 82 C102 70 92 60 80 60 Z" fill="#f5d4ad" opacity="0.55" />
            <polygon points="80,32 96,56 64,56" fill="#ffefd8" opacity="0.6" />
          </svg>
        `,
        diamonds: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="32" fill="#f1f7ff" stroke="#287ec4" stroke-width="6" />
            <path d="M80 28 C56 28 42 54 42 82 L42 98 L28 120 L80 140 L132 120 L118 98 L118 82 C118 54 104 28 80 28 Z" fill="#6ab0e8" />
            <circle cx="80" cy="82" r="28" fill="#f4d7ac" />
            <path d="M64 80 C72 74 88 74 96 80" stroke="#3f2710" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 106 C78 110 82 110 90 106" stroke="#3f2710" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,34 114,82 46,82" fill="#1c5f9a" />
            <path d="M58 126 L80 114 L102 126 L94 146 L66 146 Z" fill="#143f6a" />
            <polygon points="80,118 96,146 64,146" fill="#6ab0e8" opacity="0.6" />
          </svg>
        `,
        clubs: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="32" fill="#eaf4ff" stroke="#234b72" stroke-width="6" />
            <path d="M80 28 C54 28 40 56 40 88 L40 102 L26 124 L80 144 L134 124 L120 102 L120 88 C120 56 106 28 80 28 Z" fill="#558dd4" />
            <circle cx="80" cy="82" r="28" fill="#f3d6b0" />
            <path d="M64 80 C70 74 90 74 96 80" stroke="#402612" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M72 108 C80 112 84 112 92 108" stroke="#402612" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,34 116,84 44,84" fill="#163b63" />
            <path d="M58 128 L80 116 L102 128 L94 148 L66 148 Z" fill="#0f2742" />
            <circle cx="80" cy="126" r="12" fill="#558dd4" />
          </svg>
        `,
        spades: `
          <svg viewBox="0 0 160 160" role="img" aria-hidden="true">
            <rect x="10" y="10" width="140" height="140" rx="32" fill="#e7ecff" stroke="#1d2f5a" stroke-width="6" />
            <path d="M80 26 C54 26 38 56 38 90 L38 104 L24 126 L80 148 L136 126 L122 104 L122 90 C122 56 106 26 80 26 Z" fill="#4a63be" />
            <circle cx="80" cy="82" r="28" fill="#f0d4ab" />
            <path d="M62 82 C70 74 90 74 98 82" stroke="#38220f" stroke-width="6" stroke-linecap="round" fill="none" />
            <path d="M70 110 C80 114 84 114 94 110" stroke="#38220f" stroke-width="4" stroke-linecap="round" fill="none" />
            <polygon points="80,32 118,86 42,86" fill="#152757" />
            <path d="M58 130 L80 118 L102 130 L94 150 L66 150 Z" fill="#0d1b3e" />
            <path d="M80 60 C66 60 56 72 56 84 C68 86 92 86 104 84 C104 72 94 60 80 60 Z" fill="#f0d4ab" opacity="0.55" />
          </svg>
        `
      }
    };

    function getSuitSvg(suit, variant) {
      const template = suitSvgTemplates[variant]?.[suit];
      return template ? template.trim() : '';
    }

    function getFaceArt(value, suit) {
      const template = faceArtTemplates[value]?.[suit];
      return template ? template.trim() : '';
    }

    function createPipGrid(card) {
      const grid = document.createElement('div');
      grid.className = 'card-pips';
      const layout = pipLayouts[card.value];
      const positions = layout && layout.length ? layout : [[2, 1]];
      positions.forEach(([row, col]) => {
        const pip = document.createElement('div');
        pip.className = 'card-pip';
        pip.style.gridRow = String(row + 1);
        pip.style.gridColumn = String(col + 1);
        pip.innerHTML = getSuitSvg(card.suit, 'pip');
        grid.appendChild(pip);
      });
      return grid;
    }

    function createCardArt(card) {
      const art = document.createElement('div');
      art.className = 'card-art';
      if (card.value >= 2 && card.value <= 10) {
        art.appendChild(createPipGrid(card));
      } else if (card.value >= 11 && card.value <= 13) {
        art.classList.add('face-card');
        art.innerHTML = getFaceArt(card.value, card.suit) || getSuitSvg(card.suit, 'emblem');
      } else {
        art.classList.add('ace');
        art.innerHTML = getSuitSvg(card.suit, 'emblem');
      }
      return art;
    }
    const rankLabels = {
      11: 'J',
      12: 'Q',
      13: 'K',
      14: 'A'
    };

    const cardRow = document.getElementById('card-row');
    const statusMessage = document.getElementById('status-message');
    const betDisplay = document.getElementById('bet-display');
    const creditDisplay = document.getElementById('credit-display');
    const betDown = document.getElementById('bet-down');
    const betUp = document.getElementById('bet-up');
    const dealButton = document.getElementById('deal-button');
    const changeMachineButton = document.getElementById('change-machine');
    const addCreditsButton = document.getElementById('add-credits');
    const overlay = document.getElementById('machine-overlay');
    const machineGrid = document.getElementById('machine-grid');
    const payoutBody = document.getElementById('payout-body');
    const payoutTitle = document.getElementById('payout-title');

    let credits = 100;
    let bet = 1;
    let stage = 'select';
    let deck = [];
    let hand = [];
    let held = [false, false, false, false, false];
    let currentMachine = null;
    let lastWinHand = null;

    function buildMachineCards() {
      machineGrid.innerHTML = '';
      machines.forEach(machine => {
        const card = document.createElement('button');
        card.className = 'machine-card';
        card.type = 'button';
        card.dataset.machine = machine.id;
        card.innerHTML = `
          <h3>${machine.name}</h3>
          <p>${machine.description}</p>
          <div class="tags">${machine.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}</div>
        `;
        card.addEventListener('click', () => selectMachine(machine.id));
        machineGrid.appendChild(card);
      });
    }

    function selectMachine(id) {
      const machine = machines.find(m => m.id === id);
      if (!machine) return;
      currentMachine = machine;
      overlay.classList.remove('active');
      stage = 'ready';
      lastWinHand = null;
      statusMessage.textContent = `Playing ${machine.name}. Place your bet and press Deal.`;
      payoutTitle.textContent = `${machine.name} Payouts`;
      renderPayoutTable();
      resetHandDisplay();
      updateBet(1);
      updateCredits(0);
    }

    function resetHandDisplay() {
      hand = [];
      held = [false, false, false, false, false];
      renderHand();
    }

    function renderPayoutTable() {
      if (!currentMachine) {
        payoutBody.innerHTML = '';
        return;
      }
      payoutBody.innerHTML = '';
      currentMachine.payouts.forEach(row => {
        const tr = document.createElement('tr');
        if (lastWinHand && lastWinHand === row.hand) {
          tr.classList.add('highlight');
        }
        const nameCell = document.createElement('td');
        nameCell.textContent = row.hand;
        tr.appendChild(nameCell);
        row.values.forEach((value, index) => {
          const cell = document.createElement('td');
          cell.textContent = value;
          if (index === bet - 1) {
            cell.classList.add('bet-highlight');
          }
          tr.appendChild(cell);
        });
        payoutBody.appendChild(tr);
      });
    }

    function renderHand() {
      cardRow.innerHTML = '';
      for (let i = 0; i < 5; i++) {
        const cardData = hand[i];
        const slot = document.createElement('div');
        slot.className = 'card-slot';
        slot.dataset.index = i;
        if (!cardData) {
          slot.classList.add('placeholder', 'disabled');
          slot.textContent = '—';
        } else {
          const face = document.createElement('div');
          const isRed = cardData.suit === 'hearts' || cardData.suit === 'diamonds';
          face.className = 'card-face' + (isRed ? ' red' : '');
          const top = document.createElement('div');
          top.className = 'card-rank';
          top.textContent = rankLabels[cardData.value] || cardData.value;
          const art = createCardArt(cardData);
          const bottom = document.createElement('div');
          bottom.className = 'card-suit';
          bottom.textContent = suitSymbols[cardData.suit];
          face.appendChild(top);
          face.appendChild(art);
          face.appendChild(bottom);
          slot.appendChild(face);
          const holdTag = document.createElement('div');
          holdTag.className = 'hold-tag';
          holdTag.textContent = 'HOLD';
          slot.appendChild(holdTag);
          if (held[i]) slot.classList.add('held');
          if (stage !== 'drawing') {
            slot.classList.add('disabled');
          }
          slot.addEventListener('click', () => toggleHold(i));
        }
        cardRow.appendChild(slot);
      }
    }

    function toggleHold(index) {
      if (stage !== 'drawing') return;
      held[index] = !held[index];
      renderHand();
    }

    function updateBet(newBet) {
      const maxBet = Math.min(5, credits || 1);
      bet = Math.min(Math.max(newBet, 1), maxBet);
      betDisplay.textContent = bet;
      renderPayoutTable();
      updateBetButtons();
    }

    function updateBetButtons() {
      const maxBet = Math.min(5, credits || 1);
      betDown.disabled = stage !== 'ready' || bet <= 1;
      betUp.disabled = stage !== 'ready' || bet >= maxBet;
    }

    function updateCredits(delta) {
      credits += delta;
      if (credits < 0) credits = 0;
      creditDisplay.textContent = credits;
      if (bet > Math.min(5, credits || 1)) {
        updateBet(Math.min(5, credits || 1));
      } else {
        updateBetButtons();
        renderPayoutTable();
      }
    }

    function createDeck() {
      const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
      const deck = [];
      for (const suit of suits) {
        for (let value = 2; value <= 14; value++) {
          deck.push({ suit, value });
        }
      }
      return deck;
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function startHand() {
      if (!currentMachine) {
        statusMessage.textContent = 'Choose a machine to get started.';
        overlay.classList.add('active');
        return;
      }
      if (stage !== 'ready') return;
      if (bet > credits) {
        statusMessage.textContent = 'Not enough credits for that bet. Add credits or lower the bet.';
        return;
      }
      updateCredits(-bet);
      deck = shuffle(createDeck());
      hand = deck.splice(0, 5);
      held = [false, false, false, false, false];
      stage = 'drawing';
      dealButton.textContent = 'Draw';
      statusMessage.textContent = 'Choose cards to hold, then press Draw.';
      lastWinHand = null;
      renderHand();
      renderPayoutTable();
      updateBetButtons();
    }

    function finishHand() {
      if (stage !== 'drawing') return;
      hand = hand.map((card, index) => (held[index] ? card : deck.shift()));
      stage = 'ready';
      dealButton.textContent = 'Deal';
      held = [false, false, false, false, false];
      const result = evaluateHand(hand, currentMachine);
      lastWinHand = result.hand && result.payout > 0 ? result.hand : null;
      if (result.payout > 0) {
        updateCredits(result.payout);
        statusMessage.textContent = `${result.hand}! You win ${result.payout} credits.`;
      } else {
        statusMessage.textContent = result.hand === 'No Win' ? 'No win. Try again!' : `${result.hand}.`;
      }
      renderHand();
      renderPayoutTable();
      updateBetButtons();
    }

    function evaluateHand(cards, machine) {
      if (!machine) return { hand: 'No Win', payout: 0 };
      switch (machine.id) {
        case 'jacks':
          return evaluateJacksOrBetter(cards, machine);
        case 'bonus':
          return evaluateBonusPoker(cards, machine);
        case 'deuces':
          return evaluateDeucesWild(cards, machine);
        default:
          return { hand: 'No Win', payout: 0 };
      }
    }

    function evaluateJacksOrBetter(cards, machine) {
      const values = cards.map(c => c.value).sort((a, b) => a - b);
      const counts = getCounts(values);
      const suits = cards.map(c => c.suit);
      const flush = suits.every(s => s === suits[0]);
      const straightInfo = getStraightInfo(values);
      const hasFour = Object.values(counts).includes(4);
      const hasThree = Object.values(counts).includes(3);
      const pairValues = Object.entries(counts)
        .filter(([, count]) => count === 2)
        .map(([value]) => Number(value));

      if (flush && straightInfo.isStraight && straightInfo.high === 14 && straightInfo.low === 10) {
        return resultFor('Royal Flush', machine);
      }
      if (flush && straightInfo.isStraight) {
        return resultFor('Straight Flush', machine);
      }
      if (hasFour) {
        return resultFor('Four of a Kind', machine);
      }
      if (hasThree && pairValues.length === 1) {
        return resultFor('Full House', machine);
      }
      if (flush) {
        return resultFor('Flush', machine);
      }
      if (straightInfo.isStraight) {
        return resultFor('Straight', machine);
      }
      if (hasThree) {
        return resultFor('Three of a Kind', machine);
      }
      if (pairValues.length === 2) {
        return resultFor('Two Pair', machine);
      }
      if (pairValues.length === 1 && pairValues[0] >= 11) {
        return resultFor('Jacks or Better', machine);
      }
      return { hand: 'No Win', payout: 0 };
    }

    function evaluateBonusPoker(cards, machine) {
      const values = cards.map(c => c.value).sort((a, b) => a - b);
      const counts = getCounts(values);
      const suits = cards.map(c => c.suit);
      const flush = suits.every(s => s === suits[0]);
      const straightInfo = getStraightInfo(values);
      const countValues = Object.values(counts);
      const hasFour = countValues.includes(4);
      const hasThree = countValues.includes(3);
      const pairValues = Object.entries(counts)
        .filter(([, count]) => count === 2)
        .map(([value]) => Number(value));

      if (flush && straightInfo.isStraight && straightInfo.high === 14 && straightInfo.low === 10) {
        return resultFor('Royal Flush', machine);
      }
      if (flush && straightInfo.isStraight) {
        return resultFor('Straight Flush', machine);
      }
      if (hasFour) {
        const fourRank = Number(Object.keys(counts).find(value => counts[value] === 4));
        if (fourRank === 14) {
          return resultFor('Four Aces', machine);
        }
        if (fourRank >= 2 && fourRank <= 4) {
          return resultFor('Four 2s-4s', machine);
        }
        return resultFor('Four 5s-Ks', machine);
      }
      if (hasThree && pairValues.length === 1) {
        return resultFor('Full House', machine);
      }
      if (flush) {
        return resultFor('Flush', machine);
      }
      if (straightInfo.isStraight) {
        return resultFor('Straight', machine);
      }
      if (hasThree) {
        return resultFor('Three of a Kind', machine);
      }
      if (pairValues.length === 2) {
        return resultFor('Two Pair', machine);
      }
      if (pairValues.length === 1 && pairValues[0] >= 11) {
        return resultFor('Jacks or Better', machine);
      }
      return { hand: 'No Win', payout: 0 };
    }

    function evaluateDeucesWild(cards, machine) {
      const wilds = cards.filter(c => c.value === 2);
      const wildCount = wilds.length;
      const nonWild = cards.filter(c => c.value !== 2);
      const suits = cards.map(c => c.suit);
      const nonWildValues = nonWild.map(c => c.value);
      const counts = getCounts(nonWildValues);
      const suitsCounts = getSuitCounts(nonWild);

      if (wildCount === 0) {
        const suitsNoWild = cards.map(c => c.suit);
        const values = cards.map(c => c.value).sort((a, b) => a - b);
        const flush = suitsNoWild.every(s => s === suitsNoWild[0]);
        const straightInfo = getStraightInfo(values);
        if (flush && straightInfo.isStraight && straightInfo.high === 14 && straightInfo.low === 10) {
          return resultFor('Natural Royal Flush', machine);
        }
      }

      if (wildCount === 4) {
        return resultFor('Four Deuces', machine);
      }

      if (canMakeRoyalWithWilds(suitsCounts, wildCount)) {
        return resultFor('Wild Royal Flush', machine);
      }

      if (canMakeFiveOfAKind(counts, wildCount)) {
        return resultFor('Five of a Kind', machine);
      }

      if (canMakeStraightFlush(suitsCounts, wildCount)) {
        return resultFor('Straight Flush', machine);
      }

      if (canMakeFourOfAKind(counts, wildCount)) {
        return resultFor('Four of a Kind', machine);
      }

      if (canMakeFullHouse(counts, wildCount)) {
        return resultFor('Full House', machine);
      }

      if (canMakeFlush(suitsCounts, wildCount)) {
        return resultFor('Flush', machine);
      }

      if (canMakeStraight(counts, wildCount)) {
        return resultFor('Straight', machine);
      }

      if (canMakeThreeOfAKind(counts, wildCount)) {
        return resultFor('Three of a Kind', machine);
      }

      return { hand: 'No Win', payout: 0 };
    }

    function resultFor(handName, machine) {
      const row = machine.payouts.find(row => row.hand === handName);
      const payout = row ? row.values[bet - 1] : 0;
      return { hand: handName, payout };
    }

    function getCounts(values) {
      const counts = {};
      values.forEach(value => {
        counts[value] = (counts[value] || 0) + 1;
      });
      return counts;
    }

    function getSuitCounts(cards) {
      const suits = {};
      cards.forEach(card => {
        suits[card.suit] = suits[card.suit] || { values: [] };
        suits[card.suit].values.push(card.value);
      });
      return suits;
    }

    function getStraightInfo(sortedValues) {
      const unique = Array.from(new Set(sortedValues));
      if (unique.length !== 5) {
        return { isStraight: false, high: unique[unique.length - 1] || null, low: unique[0] || null };
      }
      const isRegularStraight = unique.every((value, index) => index === 0 || value - unique[index - 1] === 1);
      const isWheel = unique.toString() === '2,3,4,5,14';
      return {
        isStraight: isRegularStraight || isWheel,
        high: isWheel ? 5 : unique[unique.length - 1],
        low: isWheel ? 1 : unique[0]
      };
    }

    function canMakeRoyalWithWilds(suitsCounts, wildCount) {
      if (wildCount === 0) return false;
      const target = [10, 11, 12, 13, 14];
      for (const suit in suitsCounts) {
        const suitCounts = getCounts(suitsCounts[suit].values);
        if (canFormSequence(target, suitCounts, wildCount)) {
          return true;
        }
      }
      if (Object.keys(suitsCounts).length === 0 && wildCount >= 5) {
        return true;
      }
      return false;
    }

    function canMakeFiveOfAKind(counts, wildCount) {
      for (let rank = 2; rank <= 14; rank++) {
        const need = 5 - (counts[rank] || 0);
        if (need <= wildCount) {
          return true;
        }
      }
      return false;
    }

    function canMakeStraightFlush(suitsCounts, wildCount) {
      for (const suit in suitsCounts) {
        const suitCounts = getCounts(suitsCounts[suit].values);
        if (canFormAnyStraight(suitCounts, wildCount)) {
          return true;
        }
      }
      if (Object.keys(suitsCounts).length === 0 && wildCount >= 5) {
        return true;
      }
      return false;
    }

    function canMakeFourOfAKind(counts, wildCount) {
      for (let rank = 2; rank <= 14; rank++) {
        const need = 4 - (counts[rank] || 0);
        if (need <= wildCount) {
          return true;
        }
      }
      return false;
    }

    function canMakeFullHouse(counts, wildCount) {
      for (let triple = 2; triple <= 14; triple++) {
        const haveTriple = counts[triple] || 0;
        const needTriple = Math.max(0, 3 - haveTriple);
        if (needTriple > wildCount) continue;
        const remainingWilds = wildCount - needTriple;
        for (let pair = 2; pair <= 14; pair++) {
          if (pair === triple) continue;
          const havePair = counts[pair] || 0;
          const needPair = Math.max(0, 2 - havePair);
          if (needPair <= remainingWilds) {
            return true;
          }
        }
      }
      return false;
    }

    function canMakeFlush(suitsCounts, wildCount) {
      const suitTotals = Object.values(suitsCounts).map(entry => entry.values.length);
      const maxSuit = suitTotals.length ? Math.max(...suitTotals) : 0;
      return maxSuit + wildCount >= 5;
    }

    function canMakeStraight(counts, wildCount) {
      return canFormAnyStraight(counts, wildCount);
    }

    function canMakeThreeOfAKind(counts, wildCount) {
      for (let rank = 2; rank <= 14; rank++) {
        const need = 3 - (counts[rank] || 0);
        if (need <= wildCount) {
          return true;
        }
      }
      return false;
    }

    function canFormAnyStraight(counts, wildCount) {
      const sequences = [];
      for (let start = 2; start <= 10; start++) {
        sequences.push([start, start + 1, start + 2, start + 3, start + 4]);
      }
      sequences.push([14, 2, 3, 4, 5]);
      return sequences.some(seq => canFormSequence(seq, counts, wildCount));
    }

    function canFormSequence(sequence, counts, wildCount) {
      let remainingWilds = wildCount;
      const used = {};
      for (const rank of sequence) {
        const available = (counts[rank] || 0) - (used[rank] || 0);
        if (available > 0) {
          used[rank] = (used[rank] || 0) + 1;
        } else if (remainingWilds > 0) {
          remainingWilds--;
        } else {
          return false;
        }
      }
      return true;
    }

    dealButton.addEventListener('click', () => {
      if (stage === 'drawing') {
        finishHand();
      } else {
        startHand();
      }
    });

    betDown.addEventListener('click', () => {
      if (stage === 'ready') {
        updateBet(bet - 1);
      }
    });

    betUp.addEventListener('click', () => {
      if (stage === 'ready') {
        updateBet(bet + 1);
      }
    });

    changeMachineButton.addEventListener('click', () => {
      if (stage === 'drawing') {
        statusMessage.textContent = 'Finish the current hand before switching machines.';
        return;
      }
      overlay.classList.add('active');
      stage = 'select';
      statusMessage.textContent = 'Select a machine to begin.';
      renderPayoutTable();
      updateBetButtons();
    });

    addCreditsButton.addEventListener('click', () => {
      updateCredits(50);
      statusMessage.textContent = 'Added 50 credits to your balance.';
    });

    buildMachineCards();
    resetHandDisplay();
    updateBetButtons();
  </script>
  <script>
    fetch('sidebar.html')
      .then(r => r.text())
      .then(html => {
        const placeholder = document.getElementById('sidebar-placeholder');
        if (placeholder) placeholder.outerHTML = html;
      });
  </script>
</body>
</html>
