<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Burger Builder</title>
  <style>
    body {
      margin: 0;
      display: flex;
      min-height: 100vh;
      overflow: hidden;
      background: linear-gradient(135deg, #ffe0b3 0%, #ffb347 100%);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
    }
    #sidebar {
      width: 220px;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.2);
    }
    #sidebar ul { list-style:none; padding:0; margin:0; }
    #sidebar li { margin: 15px 0; }
    #sidebar a { color:#fff; text-decoration:none; }
    #game { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; padding:20px; }
    h1 { margin-top:0; font-size:2.5em; }
    canvas {
      background: linear-gradient(#d9e4f5, #a6c0e1);
      border:2px solid #fff;
      border-radius:8px;
      width:100%;
      height:auto;
      max-height:75vh;
    }
    #info { margin-top:10px; font-size:20px; }
    #message { margin-top:10px; font-size:24px; color:#ffeb3b; }
  </style>
</head>
<body>
  <div id="sidebar-placeholder"></div>
  <div id="game">
    <h1>Burger Builder</h1>
    <canvas id="gameCanvas" width="640" height="480"></canvas>
    <div id="info"></div>
    <div id="message"></div>
  </div>
  <script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const images = {};
  ['cook','enemy','burger_top','burger_lettuce','burger_patty','burger_bottom'].forEach(name=>{
    const img = new Image();
    img.src = `images/${name}.svg`;
    images[name] = img;
  });

  // tile and level setup
  const COLS = 20;
  const ROWS = 15;
  const TILE = 32;
  canvas.width = COLS * TILE;
  canvas.height = ROWS * TILE;

  const levels = [
    {
      floors: [3,7,11,15],
      ladders: [
        {x:4, top:3, bottom:15},
        {x:10, top:3, bottom:15},
        {x:16, top:3, bottom:15}
      ],
      burgerX: [6,10,14]
    },
    {
      floors: [3,6,9,12],
      ladders: [
        {x:5, top:3, bottom:12},
        {x:11, top:3, bottom:12},
        {x:17, top:3, bottom:12}
      ],
      burgerX: [4,10,16]
    }
  ];

  let levelIndex = 0;
  let floors = [];
  let ladders = [];
  let burgerX = [];
  const pieces = [];
  const types = ['top','lettuce','patty','bottom'];

  function loadLevel(index){
    levelIndex = index % levels.length;
    const level = levels[levelIndex];
    floors = level.floors.slice();
    ladders = level.ladders.map(l=>Object.assign({},l));
    burgerX = level.burgerX.slice();
    pieces.length = 0;
    for(let col of burgerX){
      for(let i=0;i<types.length;i++){
        pieces.push({x:col, y:floors[i], type:types[i], falling:false});
      }
    }
    player.x = burgerX[0];
    player.y = floors[0];
    player.pepper = 3;
    enemies = [ {x:18, y:floors[2], vx:-0.02, vy:0, width:1, height:1, stunned:0} ];
    gameOver = false;
    win = false;
    document.getElementById('message').textContent='';
  }

  const player = {x:0, y:0, vx:0, vy:0, dir:1, pepper:3, width:1, height:1};
  let enemies = [];

  let gameOver=false;
  let win=false;

  loadLevel(0);

  function isOnFloor(obj){
    return floors.some(f=>Math.abs(obj.y - f) < 0.1);
  }

  function isOnPiece(obj){
    return pieces.some(p=>!p.complete && Math.abs(obj.y - (p.y-1)) < 0.1 && obj.x>=p.x && obj.x<=p.x+1);
  }

  function pieceAt(x,y){
    return pieces.find(p=>p.x===x && p.y===y && !p.falling);
  }

  function isSupported(obj){
    return isOnFloor(obj) || isOnPiece(obj);
  }

  function ridePieces(obj){
    for(const p of pieces){
      if(p.falling && obj.x>=p.x && obj.x<=p.x+1 && Math.abs(obj.y-(p.y-1))<0.1){
        obj.y+=0.1;
      }
    }
  }

  function update(){
    if(gameOver || win) return;
    // player movement
    if(isSupported(player)){
      if(keys.left) player.vx=-0.1; else if(keys.right) player.vx=0.1; else player.vx=0;
    } else {
      player.vx = 0;
    }
    player.x += player.vx;
    if(keys.up && ladderAt(Math.round(player.x), player.y)) player.y -=0.1;
    if(keys.down && ladderAt(Math.round(player.x), player.y)) player.y +=0.1;
    player.x = Math.max(0, Math.min(COLS-1, player.x));
    player.y = Math.max(1, Math.min(ROWS-1, player.y));

    const px=Math.round(player.x), py=Math.round(player.y);
    const piece = pieceAt(px, py);
    if(piece){
      piece.falling=true;
    }

    for(const p of pieces){
      if(p.falling){
        p.y += 0.1;
        const below = pieceAt(p.x, Math.round(p.y) + 1);
        if(Math.round(p.y) >= ROWS || below){
          if(below){ below.falling = true; }
          p.falling = false;
          p.y = below ? below.y - 1 : ROWS;
          if(p.y >= ROWS){
            p.complete = true;
          }
        }
      }
    }
    ridePieces(player);

    // enemy movement
    for(const e of enemies){
      if(e.stunned>0){ e.stunned--; ridePieces(e); continue; }
      if(isSupported(e)){
        if(e.x < player.x) e.vx=0.05; else if(e.x>player.x) e.vx=-0.05; else e.vx=0;
      } else {
        e.vx = 0;
      }
      e.x += e.vx;
      e.x = Math.max(0, Math.min(COLS-1, e.x));
      // simple vertical chase
      if(Math.abs(e.x-player.x)<1 && ladderAt(Math.round(e.x), e.y)){
        if(e.y<player.y) e.y+=0.05; else if(e.y>player.y) e.y-=0.05;
      }
      const ex=Math.round(e.x), ey=Math.round(e.y);
      if(ex===px && ey===py){
        gameOver=true;
        document.getElementById('message').textContent='Game Over';
      }
      ridePieces(e);
    }

    if(pieces.every(p=>p.complete)){
      win=true;
      document.getElementById('message').textContent='Level Complete!';
      setTimeout(()=>{
        loadLevel(levelIndex + 1);
      }, 1500);
    }

    document.getElementById('info').textContent=`Pepper: ${player.pepper}`;
  }

  function ladderAt(x,y){
    return ladders.some(l=>l.x===x && y>=l.top && y<=l.bottom);
  }

  function pepper(){
    if(player.pepper<=0) return;
    player.pepper--;
    for(const e of enemies){
      if(Math.abs(e.x-player.x)<=1 && Math.abs(e.y-player.y)<=1){
        e.stunned=100; // frames
      }
    }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.save();
    ctx.scale(TILE, TILE);
    // floors
    ctx.fillStyle = '#8b5a2b';
    for (const f of floors) {
      ctx.fillRect(0, f - 0.1, COLS, 0.2);
    }
    // ladders
    ctx.strokeStyle = '#d8c18f';
    ctx.lineWidth = 0.05;
    for (const l of ladders) {
      ctx.beginPath();
      ctx.moveTo(l.x + 0.2, l.top);
      ctx.lineTo(l.x + 0.2, l.bottom);
      ctx.moveTo(l.x + 0.8, l.top);
      ctx.lineTo(l.x + 0.8, l.bottom);
      for (let y = l.top + 0.5; y < l.bottom; y += 0.5) {
        ctx.moveTo(l.x + 0.2, y);
        ctx.lineTo(l.x + 0.8, y);
      }
      ctx.stroke();
    }
    // pieces
    for(const p of pieces){
      if(p.complete) continue;
      const img = images[`burger_${p.type}`];
      if(img.complete) ctx.drawImage(img, p.x, p.y-1, 2, 1);
    }
    // player
    const pc = images.cook;
    if(pc.complete) ctx.drawImage(pc, player.x, player.y-1, 1, 1);
    // enemies
    const enemyImg = images.enemy;
    for(const e of enemies){
      const img = enemyImg;
      if(img.complete) ctx.drawImage(img, e.x, e.y-1, 1, 1);
      if(e.stunned>0){
        ctx.globalAlpha = 0.5;
        if(img.complete) ctx.drawImage(img, e.x, e.y-1, 1, 1);
        ctx.globalAlpha = 1;
      }
    }
    ctx.restore();
  }

  const keys={};
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowLeft') keys.left=true;
    if(e.key==='ArrowRight') keys.right=true;
    if(e.key==='ArrowUp') keys.up=true;
    if(e.key==='ArrowDown') keys.down=true;
    if(e.key===' ') pepper();
  });
  document.addEventListener('keyup',e=>{
    if(e.key==='ArrowLeft') keys.left=false;
    if(e.key==='ArrowRight') keys.right=false;
    if(e.key==='ArrowUp') keys.up=false;
    if(e.key==='ArrowDown') keys.down=false;
  });

  function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
  </script>
  <script>
    fetch('sidebar.html')
      .then(r=>r.text())
      .then(html=>{const placeholder=document.getElementById('sidebar-placeholder'); if(placeholder) placeholder.outerHTML=html;});
  </script>
</body>
</html>

